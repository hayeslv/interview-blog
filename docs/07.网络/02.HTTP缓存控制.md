## 一、服务器的缓存控制

为了更好地说明缓存的运行机制，下面我用 “生鲜速递” 作为比喻，看看缓存是如何工作的。

夏天到了，天气很热。你想吃西瓜，于是打开冰箱，但很不巧，冰箱是空的。不过没事，现在物流很发达，给生鲜超市打个电话，不一会儿，就给你送来一个西瓜，上面还贴着标签：“保鲜期5天”。好了，你把它放进冰箱，想吃的时候随时拿出来。

在这个场景里，“生鲜超市” 就是 Web服务器，“你” 就是浏览器，“冰箱” 就是浏览器内部的缓存。整个流程翻译成 HTTP 就是

- 浏览器发现缓存无数据，于是发送请求，向服务器获取资源；
- 服务器响应请求，返回资源，同时标记资源的有效期；
- 浏览器缓存资源，等待下次重用。



服务器标记资源有效期使用的头字段是 “Cache-Control”，里面的值 “max-age=30” 就是资源的有效时间，相当于告诉浏览器，“这个页面只能缓存30秒，之后就算是过期，不能用。”

你可能要问了，让浏览器直接缓存数据就好了，为什么要加个有效期呢？

这是因为网络上的数据随时都在变化，不能保证它稍后的一段时间还是原来的样子。就像生鲜超市给你快递西瓜，只有 5天 的保鲜期，过了这个期限最好还是别吃，不然可能会闹肚子。

`Cache-Control` 字段里的 “max-age” 是生存时间，时间的计算起点是响应报文的创建时刻（即 Date 字段，也就是离开服务器的时刻），而不是客户端收到报文的时刻，也就是说包含了在链路传输过程中所有节点所停留的时间。

比如，服务器设定 “max-age=5”，但因为网络质量很差，等浏览器收到































